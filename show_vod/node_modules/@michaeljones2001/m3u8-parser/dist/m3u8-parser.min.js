/*! @name @michaeljones2001/m3u8-parser @version 5.4.1 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("global/window")):"function"==typeof define&&define.amd?define(["exports","global/window"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).m3u8Parser={},t.window)}(this,(function(t,e){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=r(e),n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}var s=a((function(t){function e(r,i){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,e(r,i)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),o=a((function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,s(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0})),u=function(){function t(){this.listeners={}}var e=t.prototype;return e.on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},e.off=function(t,e){if(!this.listeners[t])return!1;var r=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(r,1),r>-1},e.trigger=function(t){var e=this.listeners[t];if(e)if(2===arguments.length)for(var r=e.length,i=0;i<r;++i)e[i].call(this,arguments[1]);else for(var n=Array.prototype.slice.call(arguments,1),a=e.length,s=0;s<a;++s)e[s].apply(this,n)},e.dispose=function(){this.listeners={}},e.pipe=function(t){this.on("data",(function(e){t.push(e)}))},t}(),c=function(t){function e(){var e;return(e=t.call(this)||this).buffer="",e}return o(e,t),e.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");e>-1;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},e}(u),f=a((function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,e.apply(this,arguments)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),p=String.fromCharCode(9),g=function(t){var e=/([0-9.]*)?@?([0-9.]*)?/.exec(t||""),r={};return e[1]&&(r.length=parseInt(e[1],10)),e[2]&&(r.offset=parseInt(e[2],10)),r},l=function(t){for(var e,r=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),i={},n=r.length;n--;)""!==r[n]&&((e=/([^=]*)=(.*)/.exec(r[n]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),i[e[0]]=e[1]);return i},d=function(t){function e(){var e;return(e=t.call(this)||this).customParsers=[],e.tagMappers=[],e}o(e,t);var r=e.prototype;return r.push=function(t){var e,r,i=this;0!==(t=t.trim()).length&&("#"===t[0]?this.tagMappers.reduce((function(e,r){var i=r(t);return i===t?e:e.concat([i])}),[t]).forEach((function(t){for(var n=0;n<i.customParsers.length;n++)if(i.customParsers[n].call(i,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),e=/^#EXTM3U/.exec(t))i.trigger("data",{type:"tag",tagType:"m3u"});else{if(e=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return r={type:"tag",tagType:"inf"},e[1]&&(r.duration=parseFloat(e[1])),e[2]&&(r.title=e[2]),void i.trigger("data",r);if(e=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"targetduration"},e[1]&&(r.duration=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return r={type:"tag",tagType:"version"},e[1]&&(r.version=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"media-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return r={type:"tag",tagType:"discontinuity-sequence"},e[1]&&(r.number=parseInt(e[1],10)),void i.trigger("data",r);if(e=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return r={type:"tag",tagType:"playlist-type"},e[1]&&(r.playlistType=e[1]),void i.trigger("data",r);if(e=/^#EXT-X-BYTERANGE:?(.*)?$/.exec(t))return r=f(g(e[1]),{type:"tag",tagType:"byterange"}),void i.trigger("data",r);if(e=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return r={type:"tag",tagType:"allow-cache"},e[1]&&(r.allowed=!/NO/.test(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-MAP:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"map"},e[1]){var a=l(e[1]);a.URI&&(r.uri=a.URI),a.BYTERANGE&&(r.byterange=g(a.BYTERANGE))}i.trigger("data",r)}else if(e=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t)){if(r={type:"tag",tagType:"stream-inf"},e[1]){if(r.attributes=l(e[1]),r.attributes.RESOLUTION){var s=r.attributes.RESOLUTION.split("x"),o={};s[0]&&(o.width=parseInt(s[0],10)),s[1]&&(o.height=parseInt(s[1],10)),r.attributes.RESOLUTION=o}r.attributes.BANDWIDTH&&(r.attributes.BANDWIDTH=parseInt(r.attributes.BANDWIDTH,10)),r.attributes["PROGRAM-ID"]&&(r.attributes["PROGRAM-ID"]=parseInt(r.attributes["PROGRAM-ID"],10))}i.trigger("data",r)}else{if(e=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return r={type:"tag",tagType:"media"},e[1]&&(r.attributes=l(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-ENDLIST/.exec(t))i.trigger("data",{type:"tag",tagType:"endlist"});else if(e=/^#EXT-X-DISCONTINUITY/.exec(t))i.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(e=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))return r={type:"tag",tagType:"program-date-time"},e[1]&&(r.dateTimeString=e[1],r.dateTimeObject=new Date(e[1])),void i.trigger("data",r);if(e=/^#EXT-X-KEY:?(.*)$/.exec(t))return r={type:"tag",tagType:"key"},e[1]&&(r.attributes=l(e[1]),r.attributes.IV&&("0x"===r.attributes.IV.substring(0,2).toLowerCase()&&(r.attributes.IV=r.attributes.IV.substring(2)),r.attributes.IV=r.attributes.IV.match(/.{8}/g),r.attributes.IV[0]=parseInt(r.attributes.IV[0],16),r.attributes.IV[1]=parseInt(r.attributes.IV[1],16),r.attributes.IV[2]=parseInt(r.attributes.IV[2],16),r.attributes.IV[3]=parseInt(r.attributes.IV[3],16),r.attributes.IV=new Uint32Array(r.attributes.IV))),void i.trigger("data",r);if(e=/^#EXT-X-START:?(.*)$/.exec(t))return r={type:"tag",tagType:"start"},e[1]&&(r.attributes=l(e[1]),r.attributes["TIME-OFFSET"]=parseFloat(r.attributes["TIME-OFFSET"]),r.attributes.PRECISE=/YES/.test(r.attributes.PRECISE)),void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out-cont"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-out"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if(e=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))return r={type:"tag",tagType:"cue-in"},e[1]?r.data=e[1]:r.data="",void i.trigger("data",r);if((e=/^#EXT-X-SKIP:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"skip"}).attributes=l(e[1]),r.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(r.attributes["SKIPPED-SEGMENTS"]=parseInt(r.attributes["SKIPPED-SEGMENTS"],10)),r.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(r.attributes["RECENTLY-REMOVED-DATERANGES"]=r.attributes["RECENTLY-REMOVED-DATERANGES"].split(p)),void i.trigger("data",r);if((e=/^#EXT-X-PART:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part"}).attributes=l(e[1]),["DURATION"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["INDEPENDENT","GAP"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),r.attributes.hasOwnProperty("BYTERANGE")&&(r.attributes.byterange=g(r.attributes.BYTERANGE)),void i.trigger("data",r);if((e=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"server-control"}).attributes=l(e[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=/YES/.test(r.attributes[t]))})),void i.trigger("data",r);if((e=/^#EXT-X-PART-INF:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"part-inf"}).attributes=l(e[1]),["PART-TARGET"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseFloat(r.attributes[t]))})),void i.trigger("data",r);if((e=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"preload-hint"}).attributes=l(e[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(t){if(r.attributes.hasOwnProperty(t)){r.attributes[t]=parseInt(r.attributes[t],10);var e="BYTERANGE-LENGTH"===t?"length":"offset";r.attributes.byterange=r.attributes.byterange||{},r.attributes.byterange[e]=r.attributes[t],delete r.attributes[t]}})),void i.trigger("data",r);if(e=/^#EXT-X-INDEPENDENT-SEGMENTS$/.exec(t))return r={type:"tag",tagType:"independent-segments"},void i.trigger("data",r);if((e=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(t))&&e[1])return(r={type:"tag",tagType:"rendition-report"}).attributes=l(e[1]),["LAST-MSN","LAST-PART"].forEach((function(t){r.attributes.hasOwnProperty(t)&&(r.attributes[t]=parseInt(r.attributes[t],10))})),void i.trigger("data",r);i.trigger("data",{type:"tag",data:t.slice(4)})}}}else i.trigger("data",{type:"comment",text:t.slice(1)})})):this.trigger("data",{type:"uri",uri:t}))},r.addParser=function(t){var e=this,r=t.expression,i=t.customType,n=t.dataParser,a=t.segment;"function"!=typeof n&&(n=function(t){return t}),this.customParsers.push((function(t){if(r.exec(t))return e.trigger("data",{type:"custom",data:n(t),customType:i,segment:a}),!0}))},r.addTagMapper=function(t){var e=t.expression,r=t.map;this.tagMappers.push((function(t){return e.test(t)?r(t):t}))},e}(u),h=a((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0}));function b(t){for(var e,r=(e=t,i.default.atob?i.default.atob(e):Buffer.from(e,"base64").toString("binary")),n=new Uint8Array(r.length),a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return n}var y=a((function(t,e){var r="__lodash_hash_undefined__",i=9007199254740991,a="[object Arguments]",s="[object Array]",o="[object Boolean]",u="[object Date]",c="[object Error]",f="[object Function]",p="[object Map]",g="[object Number]",l="[object Object]",d="[object Promise]",h="[object RegExp]",b="[object Set]",y="[object String]",E="[object Symbol]",T="[object WeakMap]",m="[object ArrayBuffer]",v="[object DataView]",I=/^\[object .+?Constructor\]$/,O=/^(?:0|[1-9]\d*)$/,A={};A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A[a]=A[s]=A[m]=A[o]=A[v]=A[u]=A[c]=A[f]=A[p]=A[g]=A[l]=A[h]=A[b]=A[y]=A[T]=!1;var S="object"==typeof n&&n&&n.Object===Object&&n,R="object"==typeof self&&self&&self.Object===Object&&self,_=S||R||Function("return this")(),N=e&&!e.nodeType&&e,w=N&&t&&!t.nodeType&&t,P=w&&w.exports===N,X=P&&S.process,D=function(){try{return X&&X.binding&&X.binding("util")}catch(t){}}(),C=D&&D.isTypedArray;function x(t,e){for(var r=-1,i=null==t?0:t.length;++r<i;)if(e(t[r],r,t))return!0;return!1}function M(t){var e=-1,r=Array(t.size);return t.forEach((function(t,i){r[++e]=[i,t]})),r}function j(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}var L,U,G,k=Array.prototype,Y=Function.prototype,F=Object.prototype,H=_["__core-js_shared__"],V=Y.toString,B=F.hasOwnProperty,$=(L=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+L:"",z=F.toString,K=RegExp("^"+V.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),q=P?_.Buffer:void 0,W=_.Symbol,Q=_.Uint8Array,J=F.propertyIsEnumerable,Z=k.splice,tt=W?W.toStringTag:void 0,et=Object.getOwnPropertySymbols,rt=q?q.isBuffer:void 0,it=(U=Object.keys,G=Object,function(t){return U(G(t))}),nt=Dt(_,"DataView"),at=Dt(_,"Map"),st=Dt(_,"Promise"),ot=Dt(_,"Set"),ut=Dt(_,"WeakMap"),ct=Dt(Object,"create"),ft=jt(nt),pt=jt(at),gt=jt(st),lt=jt(ot),dt=jt(ut),ht=W?W.prototype:void 0,bt=ht?ht.valueOf:void 0;function yt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Et(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Tt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function mt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Tt;++e<r;)this.add(t[e])}function vt(t){var e=this.__data__=new Et(t);this.size=e.size}function It(t,e){var r=Gt(t),i=!r&&Ut(t),n=!r&&!i&&kt(t),a=!r&&!i&&!n&&Bt(t),s=r||i||n||a,o=s?function(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}(t.length,String):[],u=o.length;for(var c in t)!e&&!B.call(t,c)||s&&("length"==c||n&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Mt(c,u))||o.push(c);return o}function Ot(t,e){for(var r=t.length;r--;)if(Lt(t[r][0],e))return r;return-1}function At(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":tt&&tt in Object(t)?function(t){var e=B.call(t,tt),r=t[tt];try{t[tt]=void 0;var i=!0}catch(t){}var n=z.call(t);i&&(e?t[tt]=r:delete t[tt]);return n}(t):function(t){return z.call(t)}(t)}function St(t){return Vt(t)&&At(t)==a}function Rt(t,e,r,i,n){return t===e||(null==t||null==e||!Vt(t)&&!Vt(e)?t!=t&&e!=e:function(t,e,r,i,n,f){var d=Gt(t),T=Gt(e),I=d?s:xt(t),O=T?s:xt(e),A=(I=I==a?l:I)==l,S=(O=O==a?l:O)==l,R=I==O;if(R&&kt(t)){if(!kt(e))return!1;d=!0,A=!1}if(R&&!A)return f||(f=new vt),d||Bt(t)?wt(t,e,r,i,n,f):function(t,e,r,i,n,a,s){switch(r){case v:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case m:return!(t.byteLength!=e.byteLength||!a(new Q(t),new Q(e)));case o:case u:case g:return Lt(+t,+e);case c:return t.name==e.name&&t.message==e.message;case h:case y:return t==e+"";case p:var f=M;case b:var l=1&i;if(f||(f=j),t.size!=e.size&&!l)return!1;var d=s.get(t);if(d)return d==e;i|=2,s.set(t,e);var T=wt(f(t),f(e),i,n,a,s);return s.delete(t),T;case E:if(bt)return bt.call(t)==bt.call(e)}return!1}(t,e,I,r,i,n,f);if(!(1&r)){var _=A&&B.call(t,"__wrapped__"),N=S&&B.call(e,"__wrapped__");if(_||N){var w=_?t.value():t,P=N?e.value():e;return f||(f=new vt),n(w,P,r,i,f)}}if(!R)return!1;return f||(f=new vt),function(t,e,r,i,n,a){var s=1&r,o=Pt(t),u=o.length,c=Pt(e).length;if(u!=c&&!s)return!1;var f=u;for(;f--;){var p=o[f];if(!(s?p in e:B.call(e,p)))return!1}var g=a.get(t);if(g&&a.get(e))return g==e;var l=!0;a.set(t,e),a.set(e,t);var d=s;for(;++f<u;){var h=t[p=o[f]],b=e[p];if(i)var y=s?i(b,h,p,e,t,a):i(h,b,p,t,e,a);if(!(void 0===y?h===b||n(h,b,r,i,a):y)){l=!1;break}d||(d="constructor"==p)}if(l&&!d){var E=t.constructor,T=e.constructor;E==T||!("constructor"in t)||!("constructor"in e)||"function"==typeof E&&E instanceof E&&"function"==typeof T&&T instanceof T||(l=!1)}return a.delete(t),a.delete(e),l}(t,e,r,i,n,f)}(t,e,r,i,Rt,n))}function _t(t){return!(!Ht(t)||function(t){return!!$&&$ in t}(t))&&(Yt(t)?K:I).test(jt(t))}function Nt(t){if(r=(e=t)&&e.constructor,i="function"==typeof r&&r.prototype||F,e!==i)return it(t);var e,r,i,n=[];for(var a in Object(t))B.call(t,a)&&"constructor"!=a&&n.push(a);return n}function wt(t,e,r,i,n,a){var s=1&r,o=t.length,u=e.length;if(o!=u&&!(s&&u>o))return!1;var c=a.get(t);if(c&&a.get(e))return c==e;var f=-1,p=!0,g=2&r?new mt:void 0;for(a.set(t,e),a.set(e,t);++f<o;){var l=t[f],d=e[f];if(i)var h=s?i(d,l,f,e,t,a):i(l,d,f,t,e,a);if(void 0!==h){if(h)continue;p=!1;break}if(g){if(!x(e,(function(t,e){if(s=e,!g.has(s)&&(l===t||n(l,t,r,i,a)))return g.push(e);var s}))){p=!1;break}}else if(l!==d&&!n(l,d,r,i,a)){p=!1;break}}return a.delete(t),a.delete(e),p}function Pt(t){return function(t,e,r){var i=e(t);return Gt(t)?i:function(t,e){for(var r=-1,i=e.length,n=t.length;++r<i;)t[n+r]=e[r];return t}(i,r(t))}(t,$t,Ct)}function Xt(t,e){var r,i,n=t.__data__;return("string"==(i=typeof(r=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function Dt(t,e){var r=function(t,e){return null==t?void 0:t[e]}(t,e);return _t(r)?r:void 0}yt.prototype.clear=function(){this.__data__=ct?ct(null):{},this.size=0},yt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yt.prototype.get=function(t){var e=this.__data__;if(ct){var i=e[t];return i===r?void 0:i}return B.call(e,t)?e[t]:void 0},yt.prototype.has=function(t){var e=this.__data__;return ct?void 0!==e[t]:B.call(e,t)},yt.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=ct&&void 0===e?r:e,this},Et.prototype.clear=function(){this.__data__=[],this.size=0},Et.prototype.delete=function(t){var e=this.__data__,r=Ot(e,t);return!(r<0)&&(r==e.length-1?e.pop():Z.call(e,r,1),--this.size,!0)},Et.prototype.get=function(t){var e=this.__data__,r=Ot(e,t);return r<0?void 0:e[r][1]},Et.prototype.has=function(t){return Ot(this.__data__,t)>-1},Et.prototype.set=function(t,e){var r=this.__data__,i=Ot(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this},Tt.prototype.clear=function(){this.size=0,this.__data__={hash:new yt,map:new(at||Et),string:new yt}},Tt.prototype.delete=function(t){var e=Xt(this,t).delete(t);return this.size-=e?1:0,e},Tt.prototype.get=function(t){return Xt(this,t).get(t)},Tt.prototype.has=function(t){return Xt(this,t).has(t)},Tt.prototype.set=function(t,e){var r=Xt(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this},mt.prototype.add=mt.prototype.push=function(t){return this.__data__.set(t,r),this},mt.prototype.has=function(t){return this.__data__.has(t)},vt.prototype.clear=function(){this.__data__=new Et,this.size=0},vt.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},vt.prototype.get=function(t){return this.__data__.get(t)},vt.prototype.has=function(t){return this.__data__.has(t)},vt.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Et){var i=r.__data__;if(!at||i.length<199)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new Tt(i)}return r.set(t,e),this.size=r.size,this};var Ct=et?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var r=-1,i=null==t?0:t.length,n=0,a=[];++r<i;){var s=t[r];e(s,r,t)&&(a[n++]=s)}return a}(et(t),(function(e){return J.call(t,e)})))}:function(){return[]},xt=At;function Mt(t,e){return!!(e=null==e?i:e)&&("number"==typeof t||O.test(t))&&t>-1&&t%1==0&&t<e}function jt(t){if(null!=t){try{return V.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function Lt(t,e){return t===e||t!=t&&e!=e}(nt&&xt(new nt(new ArrayBuffer(1)))!=v||at&&xt(new at)!=p||st&&xt(st.resolve())!=d||ot&&xt(new ot)!=b||ut&&xt(new ut)!=T)&&(xt=function(t){var e=At(t),r=e==l?t.constructor:void 0,i=r?jt(r):"";if(i)switch(i){case ft:return v;case pt:return p;case gt:return d;case lt:return b;case dt:return T}return e});var Ut=St(function(){return arguments}())?St:function(t){return Vt(t)&&B.call(t,"callee")&&!J.call(t,"callee")},Gt=Array.isArray;var kt=rt||function(){return!1};function Yt(t){if(!Ht(t))return!1;var e=At(t);return e==f||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Ft(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}function Ht(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Vt(t){return null!=t&&"object"==typeof t}var Bt=C?function(t){return function(e){return t(e)}}(C):function(t){return Vt(t)&&Ft(t.length)&&!!A[At(t)]};function $t(t){return null!=(e=t)&&Ft(e.length)&&!Yt(e)?It(t):Nt(t);var e}t.exports=function(t,e){return Rt(t,e)}}));function E(t,e){return"allowCache"===t?"#EXT-X-ALLOW-CACHE:"+(e?"YES":"NO")+"\n":"discontinuityStarts"===t?"":"version"===t?"#EXT-X-VERSION:"+e+"\n":"mediaGroups"===t?(r=e,i=Object.keys(r),n="",i.forEach((function(t){Object.keys(r[t]).forEach((function(e){var i=r[t][e];Object.keys(i).forEach((function(r){var a="#EXT-X-MEDIA:TYPE="+t;a+=',GROUP-ID="'+e+'"',a+=',NAME="'+r+'"',Object.keys(i[r]).forEach((function(t){var e=i[r][t];"instreamId"===t&&(t="INSTREAM-ID");var n=["URI","LANGUAGE","ASSOC-LANGUAGE","INSTREAM-ID","CHARACTERISTICS","CHANNELS"].includes(t.toUpperCase());a+=","+t.toUpperCase()+"="+(n?'"':"")+e+(n?'"':"")})),n+=a+"\n"}))}))})),n+"\n"):"playlists"===t?function(t){var e="";return t.forEach((function(t){var r="#EXT-X-STREAM-INF:";Object.keys(t.attributes).forEach((function(e){var i=["CODECS","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS"].includes(e.toUpperCase()),n=t.attributes[e];"RESOLUTION"===e&&(n=n.width+"x"+n.height),"FRAME-RATE"===e&&(n=parseFloat(n).toFixed(3)),r+=","+e.toUpperCase()+"="+(i?'"':"")+n+(i?'"':"")})),r+="\n"+t.uri+"\n",e+=r+"\n"})),e}(e):"targetDuration"===t?"#EXT-X-TARGETDURATION:"+e+"\n":"mediaSequence"===t?"#EXT-X-MEDIA-SEQUENCE:"+e+"\n":"playlistType"===t?"#EXT-X-PLAYLIST-TYPE:"+e+"\n":"segments"===t?function(t){var e="",r={},i={};return t.forEach((function(t){var n="\n";if(t.key&&!y(t.key,r)){var a=t.key.iv?",IV=0x"+t.key.iv.reduce((function(t,e){return t+("00000000"+e.toString(16)).slice(-8)}),""):"";n+="#EXT-X-KEY:METHOD="+t.key.method+',URI="'+t.key.uri+'"'+a+"\n",r=t.key}else t.key||T(r)||(n+="#EXT-X-KEY:METHOD=NONE\n");if(t.map&&!y(t.map,i)){void 0===t.map.byterange.offset&&(t.map.byterange.offset=0);var s=t.map.byterange?',BYTERANGE="'+t.map.byterange.length+"@"+t.map.byterange.offset+'"':"";n+='#EXT-X-MAP:URI="'+t.map.uri+'"'+s+"\n",i=t.map}t.discontinuity&&(n+="#EXT-X-DISCONTINUITY\n"),n+="#EXTINF:"+t.duration+",\n",t.dateTimeString&&(n+="#EXT-X-PROGRAM-DATE-TIME:"+t.dateTimeString+"\n"),t.byterange&&(n+="#EXT-X-BYTERANGE:"+t.byterange.length+"@"+t.byterange.offset+"\n"),n+=t.uri,e+=n+"\n"})),e}(e):"discontinuitySequence"===t?"#EXT-X-DISCONTINUITY-SEQUENCE:"+e+"\n":"start"===t?"#EXT-X-START:TIME-OFFSET="+e.timeOffset+",PRECISE="+e.precise+"\n":"endList"===t?e?"#EXT-X-ENDLIST\n":"":"independentSegments"===t?"#EXT-X-INDEPENDENT-SEGMENTS\n":"";var r,i,n}function T(t){return"object"==typeof t&&(t.constructor===Object||t.constructor===Array)&&0===Object.keys(t).length}var m=["version","mediaGroups","playlists","targetDuration","mediaSequence","playlistType","discontinuitySequence","independentSegments","start","segments","endList"];var v=function(t){var e={};return Object.keys(t).forEach((function(r){var i;e[(i=r,i.toLowerCase().replace(/-(\w)/g,(function(t){return t[1].toUpperCase()})))]=t[r]})),e},I=function(t){var e=t.serverControl,r=t.targetDuration,i=t.partTargetDuration;if(e){var n="#EXT-X-SERVER-CONTROL",a="holdBack",s="partHoldBack",o=r&&3*r,u=i&&2*i;r&&!e.hasOwnProperty(a)&&(e[a]=o,this.trigger("info",{message:n+" defaulting HOLD-BACK to targetDuration * 3 ("+o+")."})),o&&e[a]<o&&(this.trigger("warn",{message:n+" clamping HOLD-BACK ("+e[a]+") to targetDuration * 3 ("+o+")"}),e[a]=o),i&&!e.hasOwnProperty(s)&&(e[s]=3*i,this.trigger("info",{message:n+" defaulting PART-HOLD-BACK to partTargetDuration * 3 ("+e[s]+")."})),i&&e[s]<u&&(this.trigger("warn",{message:n+" clamping PART-HOLD-BACK ("+e[s]+") to partTargetDuration * 2 ("+u+")."}),e[s]=u)}},O=function(t){function e(){var e;(e=t.call(this)||this).lineStream=new c,e.parseStream=new d,e.lineStream.pipe(e.parseStream);var r,i,n=h(e),a=[],s={},o=!1,u=function(){},p={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},g=0;e.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var l=0,y=0;return e.on("end",(function(){s.uri||!s.parts&&!s.preloadHints||(!s.map&&r&&(s.map=r),!s.key&&i&&(s.key=i),s.timeline||"number"!=typeof g||(s.timeline=g),e.manifest.preloadSegment=s)})),e.parseStream.on("data",(function(t){var e,c;({tag:function(){({version:function(){t.version&&(this.manifest.version=t.version)},"allow-cache":function(){this.manifest.allowCache=t.allowed,"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var e={};"length"in t&&(s.byterange=e,e.length=t.length,"offset"in t||(t.offset=l)),"offset"in t&&(s.byterange=e,e.offset=t.offset),l=e.offset+e.length},endlist:function(){this.manifest.endList=!0},"independent-segments":function(){this.manifest.independentSegments=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),t.duration>0&&(s.duration=t.duration),0===t.duration&&(s.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=a},key:function(){if(t.attributes)if("NONE"!==t.attributes.METHOD)if(t.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===t.attributes.KEYFORMAT){return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(t.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===t.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==t.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):t.attributes.KEYID&&"0x"===t.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:t.attributes.KEYFORMAT,keyId:t.attributes.KEYID.substring(2)},pssh:b(t.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}))}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI},void 0!==t.attributes.IV&&(i.iv=t.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(t.number)?this.manifest.mediaSequence=t.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number})},"discontinuity-sequence":function(){isFinite(t.number)?(this.manifest.discontinuitySequence=t.number,g=t.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number})},"playlist-type":function(){/VOD|EVENT/.test(t.playlistType)?this.manifest.playlistType=t.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist})},map:function(){r={},t.uri&&(r.uri=t.uri),t.byterange&&(r.byterange=t.byterange)},"stream-inf":function(){this.manifest.playlists=a,this.manifest.mediaGroups=this.manifest.mediaGroups||p,t.attributes?(s.attributes||(s.attributes={}),f(s.attributes,t.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||p,t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME){var r=this.manifest.mediaGroups[t.attributes.TYPE];r[t.attributes["GROUP-ID"]]=r[t.attributes["GROUP-ID"]]||{},e=r[t.attributes["GROUP-ID"]],(c={default:/yes/i.test(t.attributes.DEFAULT)}).default?c.autoselect=!0:c.autoselect=/yes/i.test(t.attributes.AUTOSELECT),t.attributes.LANGUAGE&&(c.language=t.attributes.LANGUAGE),t.attributes.URI&&(c.uri=t.attributes.URI),t.attributes["INSTREAM-ID"]&&(c.instreamId=t.attributes["INSTREAM-ID"]),t.attributes.CHARACTERISTICS&&(c.characteristics=t.attributes.CHARACTERISTICS),t.attributes.FORCED&&(c.forced=/yes/i.test(t.attributes.FORCED)),e[t.attributes.NAME]=c}else this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){g+=1,s.discontinuity=!0,this.manifest.discontinuityStarts.push(a.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=t.dateTimeString,this.manifest.dateTimeObject=t.dateTimeObject),s.dateTimeString=t.dateTimeString,s.dateTimeObject=t.dateTimeObject},targetduration:function(){!isFinite(t.duration)||t.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration}):(this.manifest.targetDuration=t.duration,I.call(this,this.manifest))},start:function(){t.attributes&&!isNaN(t.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:t.attributes["TIME-OFFSET"],precise:t.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){s.cueOut=t.data},"cue-out-cont":function(){s.cueOutCont=t.data},"cue-in":function(){s.cueIn=t.data},skip:function(){this.manifest.skip=v(t.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",t.attributes,["SKIPPED-SEGMENTS"])},part:function(){var e=this;o=!0;var r=this.manifest.segments.length,i=v(t.attributes);s.parts=s.parts||[],s.parts.push(i),i.byterange&&(i.byterange.hasOwnProperty("offset")||(i.byterange.offset=y),y=i.byterange.offset+i.byterange.length);var n=s.parts.length-1;this.warnOnMissingAttributes_("#EXT-X-PART #"+n+" for segment #"+r,t.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach((function(t,r){t.hasOwnProperty("lastPart")||e.trigger("warn",{message:"#EXT-X-RENDITION-REPORT #"+r+" lacks required attribute(s): LAST-PART"})}))},"server-control":function(){var e=this.manifest.serverControl=v(t.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),I.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint":function(){var e=this.manifest.segments.length,r=v(t.attributes),i=r.type&&"PART"===r.type;s.preloadHints=s.preloadHints||[],s.preloadHints.push(r),r.byterange&&(r.byterange.hasOwnProperty("offset")||(r.byterange.offset=i?y:0,i&&(y=r.byterange.offset+r.byterange.length)));var n=s.preloadHints.length-1;if(this.warnOnMissingAttributes_("#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e,t.attributes,["TYPE","URI"]),r.type)for(var a=0;a<s.preloadHints.length-1;a++){var o=s.preloadHints[a];o.type&&(o.type===r.type&&this.trigger("warn",{message:"#EXT-X-PRELOAD-HINT #"+n+" for segment #"+e+" has the same TYPE "+r.type+" as preload hint #"+a}))}},"rendition-report":function(){var e=v(t.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);var r=this.manifest.renditionReports.length-1,i=["LAST-MSN","URI"];o&&i.push("LAST-PART"),this.warnOnMissingAttributes_("#EXT-X-RENDITION-REPORT #"+r,t.attributes,i)},"part-inf":function(){this.manifest.partInf=v(t.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",t.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),I.call(this,this.manifest)}}[t.tagType]||u).call(n)},uri:function(){s.uri=t.uri,a.push(s),this.manifest.targetDuration&&!("duration"in s)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),s.duration=this.manifest.targetDuration),i&&(s.key=i),s.timeline=g,r&&(s.map=r),y=0,s={}},comment:function(){},custom:function(){t.segment?(s.custom=s.custom||{},s.custom[t.customType]=t.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[t.customType]=t.data)}})[t.type].call(n)})),e}o(e,t);var r=e.prototype;return r.warnOnMissingAttributes_=function(t,e,r){var i=[];r.forEach((function(t){e.hasOwnProperty(t)||i.push(t)})),i.length&&this.trigger("warn",{message:t+" lacks required attribute(s): "+i.join(", ")})},r.push=function(t){this.lineStream.push(t)},r.end=function(){this.lineStream.push("\n"),this.trigger("end")},r.addParser=function(t){this.parseStream.addParser(t)},r.addTagMapper=function(t){this.parseStream.addTagMapper(t)},r.stringify=function(){return function(t){var e="";e+="#EXTM3U\n";var r=Object.keys(t);return m.forEach((function(i){r.includes(i)&&!T(r[i])&&(e+=E(i,t[i]))})),e=(e=(e=e.replace(/:,/g,":")).replace(/true/g,"YES")).replace(/false/g,"NO")}(this.manifest)},e}(u);t.LineStream=c,t.ParseStream=d,t.Parser=O,Object.defineProperty(t,"__esModule",{value:!0})}));
