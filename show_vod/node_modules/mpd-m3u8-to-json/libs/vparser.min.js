!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.VParser=r():e.VParser=r()}(this,(function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var u in e)t.d(n,u,function(r){return e[r]}.bind(null,u));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){"use strict";function n(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}t.r(r),t.d(r,"m3u8Parser",(function(){return f})),t.d(r,"mpdParser",(function(){return y}));var o=/EXT(?:-X-)?([^:]+):?(.*)$/,i=/([^,="]+)((="[^"]+")|(=[^,]+))*/g;function s(e){return e.split("-").reduce((function(e,r){return e+=e?r.charAt(0)+r.slice(1).toLowerCase():r.toLowerCase()}),"")}function l(e){if(!/^#EXT/.test(e)&&/^\s*#/.test(e))return null;var r,t,l=o.exec(e);return l?(r=s(l[1]),t=function(e){if(!e)return null;var r=e.match(i).map((function(e){return function(e){var r=e.trim().replace("=","|").split("|");if(2==r.length){return a({},s(r[0]),r[1].replace(/("|')/g,""))}var t=parseFloat(r[0]);return Number.isNaN(t)?r[0]:t}(e)}));if(1===r.length)return r[0];if(0===r.filter((function(e){return"object"===u(e)})).length)return r;return r.reduce((function(e,r){return function(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?n(Object(t),!0).forEach((function(r){a(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}({},e,{},r)}),{})}(l[2])):(r="url",t=e),a({},r,t)}function c(e,r){if(/^https?/.test(e)||/^data:/.test(e)||/^sdk:/.test(e))return e;for(r=r.split("/").slice(0,-1),e=e.split("/");e.length;){var t=e.shift();-1==r.indexOf(t)&&r.push(t)}return r.join("/")}var f=function(e,r,t){if(!e||!r)return{error:1,msg:"invalid input"};var n,u=e.split("\n").filter(Boolean).map((function(e){return l(e.trim())})).filter(Boolean);if(!u.length)return{error:1,msg:"invalid m3u8"};n=0!==u.filter((function(e){return!!e.streamInf})).length?{master:!0,m3u8Url:r,levels:[],medias:[]}:{master:!1,m3u8Url:r,duration:0,startSN:0,endSN:0,segments:[],live:!0};try{n=function(e,r,t){for(var n=r.master,u=e.length,a=0,o=0,i=0,s=0,l=0,f=-1,p=0;p<u;p++){var m=e[p];for(var d in m){var b=m[d];switch(b&&b.uri&&(b.url=c(b.uri,r.m3u8Url)),d){case"inf":var y={start:o,end:o+(Array.isArray(b)?b[0]:b),cc:a,sn:i+s};f>=0&&(y.keyIndex=f),s++,o=y.end,r.segments.push(y);break;case"start":o=b;break;case"discontinuity":a++;break;case"mediaSequence":i=b;break;case"streamInf":l++,b.levelId=l,r.levels.push(b);break;case"media":r.medias.push(b);break;case"endlist":r.live=!1;break;case"key":f++,r.key?r.key.push(b):r.key=[b];break;case"url":var g=n?r.levels:r.segments;if(!g.length)throw new Error("invalid m3u8");n?g[l-1].url=c(b,r.m3u8Url):g[s-1].url=c(b,r.m3u8Url);break;default:b&&(r[d]=b)}}t&&(r=t(m,r))}return n||(r.startSN=i,r.endSN=i+s-1,r.duration=o),r}(u,n,t)}catch(a){return{error:1,msg:a.message}}return n};var p=/\s*(<\/?[^>]+>)/,m=/\s*(?:<\/?([^\s>]+))?\s*([^>]+)*(?:\/?>)?/,d=/\s*([^=]+)="([^"]+)"/g;function b(e,r){for(var t,n,u,a=[],o=e.length,i=0;i<o;i++)if((t=e[i]).closed)if(n=a.pop(),"pureValue"!==t.tagName){if(n&&n.tagName===t.tagName?u=a.pop():(u=n,n=t),!u){a.push(n);break}var s=n,l=s.tagName,c=s.attrs,f=u.attrs[l];r&&(c=r(l,c)),u.attrs[l]=f?Array.isArray(f)?f.concat(c):[f,c]:c,a.push(u)}else n.attrs?n.attrs.value=t.attrs.value:n.attrs=t.attrs,a.push(n);else a.push(t);var p,m,d,b=a[0];return b?"undefined"!=b.tagName?(p={},m=b.tagName,d=b.attrs,m in p?Object.defineProperty(p,m,{value:d,enumerable:!0,configurable:!0,writable:!0}):p[m]=d,p):b.tagName:null}var y=function(e,r){if(!e)return{error:1,msg:"invalid input"};try{return b(e.split(p).filter(Boolean).map((function(e){return function(e){var r=e.match(m),t={},n=function(e){return e?e.split("_").reduce((function(e,r){return e?e+=r.charAt(0).toUpperCase()+r.slice(1):e=r.charAt(0).toLowerCase()+r.slice(1)}),""):""}(r&&r[1]);if(r&&r[1]&&r[2]){for(var u,a={};null!=(u=d.exec(r[2]));)a[u[1]]=u[2];return"?xml"===n?null:(t.tagName=n,t.attrs=a,t.closed=/\/$/.test(r[2]),t)}return r?/^<\//.test(r[0])?(t.tagName=n,t.closed=!0,t):/^</.test(r[0])?(t.tagName=n,t.attrs={},t):(t.tagName="pureValue",t.attrs={value:r[2]},t.closed=!0,t):null}(e)})).filter(Boolean),r)}catch(t){return{error:1,msg:t.message}}}}])}));
//# sourceMappingURL=vparser.min.js.map